; ***********************************
; * 
; * William Bergmann Børresen
; ***********************************
; * Written for MIC ATmega32A board
; * 
; * 
; ***********************************
.include "m32def.inc"

;værdier til dispaly

.equ segA=0b10111111
.equ segB=0b11110111
.equ segC=0b11111011
.equ segD=0b11111101
.equ segE=0b11111110
.equ segF=0b11101111

;Initialisér programmet
RESET:
; PORTC setup
		LDI		R16, 0x00			; 
		OUT		DDRC, R16			; Set PORTC as input
		LDI		R16, 255			;
		OUT		PORTC,R16 			; Enable pull-up on PORTC
				
; PORTB setup
		OUT 		DDRB,R16 			; PORTB = output
		LDI		R16, 0xFF
		OUT		PORTB, R16			; Turn LEDS off

;Start programløkken
LOOP:

Aseg:
		LDI		R18, segA
		OUT		PORTB, R18
		IN 		R17, PINC			;læs værdien af port c ind i R17
		LDI		R20, 0x97
Loopa0:		LDI		R21, 0x06
Loopa1:		LDI		R22, 0x92
Loopa2:		DEC		R22
		BRNE		Loopa2
		DEC		R21
		BRNE		Loopa1
		DEC		R20
		BRNE		Loopa0
		IN		R18, PINC			;læs værdien af port c ind i R18
		CP		R17, R18			;Sammenlign R17 og R18
		BREQ		Aseg				;Hvis CP gav true gå til Aseg

Bseg:
		LDI		R18, segB
		OUT		PORTB, R18
		IN 		R17, PINC			;læs værdien af port c ind i R17
		LDI		R20, 0x97
Loopb0:		LDI		R21, 0x06
Loopb1:		LDI		R22, 0x92
Loopb2:		DEC		R22
		BRNE		Loopb2
		DEC		R21
		BRNE		Loopb1
		DEC		R20
		BRNE		Loopb0
		IN		R18, PINC			;læs værdien af port c ind i R18
		CP		R17, R18			;Sammenlign R17 og R18
		BREQ		Bseg				;Hvis CP gav true gå til Bseg

Cseg:
		LDI		R18, segC
		OUT		PORTB, R18
		IN 		R17, PINC			;læs værdien af port c ind i R17
		LDI		R20, 0x97
Loopc0:		LDI		R21, 0x06
Loopc1:		LDI		R22, 0x92
Loopc2:		DEC		R22
		BRNE		Loopc2
		DEC		R21
		BRNE		Loopc1
		DEC		R20
		BRNE		Loopc0
		IN		R18, PINC			;læs værdien af port c ind i R18
		CP		R17, R18			;Sammenlign R17 og R18
		BREQ		Cseg				;Hvis CP gav true gå til Cseg

Dseg:
		LDI		R18, segD
		OUT		PORTB, R18
		IN 		R17, PINC			;læs værdien af port c ind i R17
		LDI		R20, 0x97
Loopd0:		LDI		R21, 0x06
Loopd1:		LDI		R22, 0x92
Loopd2:		DEC		R22
		BRNE		Loopd2
		DEC		R21
		BRNE		Loopd1
		DEC		R20
		BRNE		Loopd0
		IN		R18, PINC			;læs værdien af port c ind i R18
		CP		R17, R18			;Sammenlign R17 og R18
		BREQ		Dseg				;Hvis CP gav true gå til Dseg

Eseg:
		LDI		R18, segE
		OUT		PORTB, R18
		IN 		R17, PINC			;læs værdien af port c ind i R17
		LDI		R20, 0x97
Loope0:		LDI		R21, 0x06
Loope1:		LDI		R22, 0x92
Loope2:		DEC		R22
		BRNE		Loope2
		DEC		R21
		BRNE		Loope1
		DEC		R20
		BRNE		Loope0
		IN		R18, PINC			;læs værdien af port c ind i R18
		CP		R17, R18			;Sammenlign R17 og R18
		BREQ		Eseg				;Hvis CP gav true gå til Eseg

Fseg:
		LDI		R18, segF
		OUT		PORTB, R18
		IN 		R17, PINC			;læs værdien af port c ind i R17
		LDI		R20, 0x97
Loopf0:		LDI		R21, 0x06
Loopf1:		LDI		R22, 0x92
Loopf2:		DEC		R22
		BRNE		Loopf2
		DEC		R21
		BRNE		Loopf1
		DEC		R20
		BRNE		Loopf0
		IN		R18, PINC			;læs værdien af port c ind i R18
		CP		R17, R18			;Sammenlign R17 og R18
		BREQ		Fseg				;Hvis CP gav true gå til Fseg

		rjmp		LOOP


	
