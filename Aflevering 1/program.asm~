; ***********************************
; * 7-segment display
; * William B Børresen
; ***********************************
; * Written for MIC ATmega32A board
; * drives in a circle
; * when a butten i toggeled
; ***********************************
.include "m32def.inc"
;Initialisér programmet
RESET:
; PORTC setup
		ldi		R16, 0x00			; 
		out		DDRC, R16			; Set PORTC as input
		ldi		R16, 255			;
		out 		PORTC,R16 			; Enable pull-up on PORTC
				
; PORTB setup
		out 		DDRB,R16 			; PORTB = output
		ldi		R16, 0xFF
		out		PORTB, R16			; Turn LEDS off

; ***********************************
; * Main program
; ***********************************
main:	
	
	;in	R17,PINC		;Læs port C til R17
	LPM	R17, 255
	OUT	PORTB, R17
	LDI	R16, 250		;Indlæs antal iterationer for forsinkelsen
	DELAY:
	NOP				;Gør intet (bruger 1 cycle)
	DEC	R16			;Sæt R16 <-- R16-1 (bruger 1 cycle)
	BRNE	DELAY			;Er R16!=0, gå til DELAY (bruger 2 cycles)
	LPM	R17, 0
	OUT	PORTB, R17	
	rjmp	main			; Loop forever






	in	R16,PINC 		; read port C
	com	R16			; take complement to accomodate active low
	ldi 	R17, 0x0F		; load mask
	and 	R16, R17		; mask out high nibble

	ldi	ZH,high(digits<<1)	; make high byte of Z point at address of digit 0
	ldi 	ZL,low(digits<<1)	; make low byte of Z point at address of digit 0

	add	ZL, R16			; Offset Z to point at the digit corresponding to switches
	ldi	R16, 0			; Load zero
	adc	ZH, R16			; Add high byte of Z with carry

	lpm	R16, Z			; Load the data that Z points to
	out	PORTB, R16		; Display data on port
	rjmp	main			; Loop forever


